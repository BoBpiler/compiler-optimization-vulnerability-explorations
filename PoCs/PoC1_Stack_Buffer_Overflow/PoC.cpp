#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>

#define array_size 13 // odd number

class Foo {
    public:
    void init(char* arr, int size) {
        for(int i = 0; i < size; i++) {
            arr[i] = array_size;
        }
    }
// arr[0x0d]
// 0x0d 0x0d 0x0d 0x0d .. 0x0d 0x0d 0x0d 0x0d 

    void __declspec(noinline) dong() {
        volatile int16_t buf_size = 0;
        char buffer[array_size];
        init(buffer, array_size);
        buf_size = buffer[array_size - 1]; // /O1, /O2, /Ox에서 큰수로 판단
    
        printf("bug val = 0x%p\n", &buf_size); // Need to Leak !
        fflush(stdout);
        fgets(buffer, buf_size, stdin);

        printf("your_msg : %s\n", buffer);

        bar();
    }

    virtual void __declspec(noinline) bar() {
        printf("bar\n");
    }
};


int main(int argc, char *argv[]) {
    Foo foo;
    foo.dong();
    return 0;
}
