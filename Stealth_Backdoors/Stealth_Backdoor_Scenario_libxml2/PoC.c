#include <stdio.h>
#include <libxml/parser.h>
#include <libxml/tree.h>
#include <libxml/xinclude.h>

int main() {
    LIBXML_TEST_VERSION  // Initialize the library and check for ABI mismatches

    const char* filename = "buffer_overflow.xml";
    xmlDocPtr doc = xmlReadFile(filename, NULL, 0);  // Read the XML document

    if (!doc) {
        fprintf(stderr, "Failed to parse %s\n", filename);
        return -1;
    }

    // This call leads to the vulnerable xmlNanoHTTPMethodRedir function
    if (xmlXIncludeProcess(doc) != 1) {  // Process XInclude
        fprintf(stderr, "Failed to process include %s\n", filename);
        xmlFreeDoc(doc);
        xmlCleanupParser();
        return -1;
    }

    printf("XInclude processing successful.\n");
    xmlFreeDoc(doc);
    xmlCleanupParser();
    return 0;
}
